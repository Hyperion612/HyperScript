{% extends 'base.html' %}
{% load static %}

{% block title %}–¢—Ä–µ–Ω–∞–∂–µ—Ä —Å—á–µ—Ç–∞ - HyperScript{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">üßÆ –¢—Ä–µ–Ω–∞–∂–µ—Ä —É—Å—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞</h1>
            <p class="lead">–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏ —É–ª—É—á—à–∞–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å —Å—á–µ—Ç–∞</p>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary operation-btn" data-operation="addition">
                            ‚ûï –°–ª–æ–∂–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline-success operation-btn" data-operation="subtraction">
                            ‚ûñ –í—ã—á–∏—Ç–∞–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline-warning operation-btn" data-operation="multiplication">
                            ‚úñÔ∏è –£–º–Ω–æ–∂–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline-info operation-btn" data-operation="division">
                            ‚ûó –î–µ–ª–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">–°–ª–æ–∂–Ω–æ—Å—Ç—å</h5>
                </div>
                <div class="card-body">
                    <select class="form-select" id="difficultySelect">
                        <option value="easy">–õ–µ–≥–∫–∞—è (1-10)</option>
                        <option value="medium">–°—Ä–µ–¥–Ω—è—è (10-50)</option>
                        <option value="hard">–°–ª–æ–∂–Ω–∞—è (50-100)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0" id="gameTitle">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞</h5>
                </div>
                <div class="card-body text-center">
                    <div id="startPanel">
                        <div class="py-5">
                            <i class="fas fa-brain fa-5x text-muted mb-4"></i>
                            <h3>–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏?</h3>
                            <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
                        </div>
                    </div>

                    <div id="gamePanel" style="display: none;">
                        <div class="row mb-4">
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <small>–°—á–µ—Ç</small>
                                    <div class="h4 mb-0" id="score">0</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <small>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</small>
                                    <div class="h4 mb-0 text-success" id="correct">0</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <small>–û—à–∏–±–∫–∏</small>
                                    <div class="h4 mb-0 text-danger" id="incorrect">0</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <small>–í—Ä–µ–º—è</small>
                                    <div class="h4 mb-0" id="timer">60</div>
                                </div>
                            </div>
                        </div>

                        <div id="questionPanel">
                            <div class="display-4 mb-4" id="questionText"></div>
                            <div class="row justify-content-center">
                                <div class="col-md-6">
                                    <input type="number" class="form-control form-control-lg text-center" 
                                           id="answerInput" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç" autofocus>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-primary btn-lg" id="submitAnswer">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü—Ä–æ—Å—Ç–æ–π JavaScript –¥–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞
document.addEventListener('DOMContentLoaded', function() {
    const operationBtns = document.querySelectorAll('.operation-btn');
    const startPanel = document.getElementById('startPanel');
    const gamePanel = document.getElementById('gamePanel');
    const gameTitle = document.getElementById('gameTitle');
    const questionText = document.getElementById('questionText');
    const answerInput = document.getElementById('answerInput');
    const submitBtn = document.getElementById('submitAnswer');
    
    let currentOperation = '';
    let currentQuestion = '';
    let currentAnswer = 0;
    
    operationBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            currentOperation = this.dataset.operation;
            const operationNames = {
                'addition': '–°–ª–æ–∂–µ–Ω–∏–µ',
                'subtraction': '–í—ã—á–∏—Ç–∞–Ω–∏–µ', 
                'multiplication': '–£–º–Ω–æ–∂–µ–Ω–∏–µ',
                'division': '–î–µ–ª–µ–Ω–∏–µ'
            };
            
            gameTitle.textContent = `–¢—Ä–µ–Ω–∞–∂–µ—Ä: ${operationNames[currentOperation]}`;
            startPanel.style.display = 'none';
            gamePanel.style.display = 'block';
            
            generateQuestion();
        });
    });
    
    function generateQuestion() {
        const difficulty = document.getElementById('difficultySelect').value;
        
        fetch(`/math/operation/${currentOperation}/?difficulty=${difficulty}`)
            .then(response => response.json())
            .then(data => {
                questionText.textContent = data.question;
                currentAnswer = data.answer;
                answerInput.value = '';
                answerInput.focus();
            })
            .catch(error => {
                console.error('Error:', error);
                questionText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–∞';
            });
    }
    
    submitBtn.addEventListener('click', checkAnswer);
    answerInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') checkAnswer();
    });
    
    function checkAnswer() {
        const userAnswer = parseInt(answerInput.value);
        
        if (isNaN(userAnswer)) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ');
            return;
        }
        
        if (userAnswer === currentAnswer) {
            alert('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ');
        } else {
            alert(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${currentAnswer}`);
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        setTimeout(generateQuestion, 1000);
    }
});
</script>
{% endblock %}
{% extends 'base.html' %}

{% block title %}{{ month_name }} {{ year }} - HyperScript{% endblock %}

{% block content %}
<div class="container">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üìÖ {{ month_name }} {{ year }}</h1>
        <a href="{% url 'year_calendar' %}" class="btn btn-outline-secondary">
            –ù–∞–∑–∞–¥ –∫ –≥–æ–¥–∞–º
        </a>
    </div>

    <!-- –û—Ç–ª–∞–¥–∫–∞ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–æ—Ç–æ–º) -->
    <div class="alert alert-info mb-4">
        <strong>–û—Ç–ª–∞–¥–∫–∞:</strong><br>
        –ì–æ–¥: {{ year }}, –ú–µ—Å—è—Ü: {{ month }}<br>
        –ù–µ–¥–µ–ª—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ: {{ calendar|length }}<br>
        –°–µ–≥–æ–¥–Ω—è: {{ today|date:"d.m.Y" }}<br>
        –ü—Ä–µ–¥—ã–¥—É—â–∏–π: {{ prev_year }}/{{ prev_month }} | –°–ª–µ–¥—É—é—â–∏–π: {{ next_year }}/{{ next_month }}
    </div>

    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <div class="row text-center fw-bold">
                <div class="col p-2">–ü–Ω</div>
                <div class="col p-2">–í—Ç</div>
                <div class="col p-2">–°—Ä</div>
                <div class="col p-2">–ß—Ç</div>
                <div class="col p-2">–ü—Ç</div>
                <div class="col p-2">–°–±</div>
                <div class="col p-2 text-danger">–í—Å</div>
            </div>
        </div>

        <div class="card-body p-0">
            {% for week in calendar %}
            <div class="row week-row g-0 border-top">
                {% for day in week %}
                <div class="col day-cell border-end
                    {% if day == 0 %} bg-light text-muted{% endif %}
                    {% if day != 0 and today.year == year and today.month == month and day == today.day %}
                        bg-warning bg-opacity-25
                    {% endif %}">

                    {% if day != 0 %}
                        <div class="day-number
                            {% if today.year == year and today.month == month and day == today.day %}
                                fw-bold text-danger
                            {% elif forloop.parentloop.last and forloop.counter >= 6 %}
                                text-danger
                            {% endif %}">
                            {{ day }}
                        </div>
                        
                        <!-- –ú–µ—Å—Ç–æ –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å) -->
                        <div class="events mt-1">
                            <!-- –ë—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–æ–±—ã—Ç–∏—è –¥–Ω—è -->
                        </div>
                    {% endif %}

                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º -->
    <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'month_calendar' prev_year prev_month %}" class="btn btn-primary">
            ‚Üê {{ prev_month|stringformat:"02d" }}.{{ prev_year }}
        </a>
        
        <div class="btn-group">
            <a href="{% url 'year_calendar' %}" class="btn btn-outline-secondary">
                –ö –≤—ã–±–æ—Ä—É –≥–æ–¥–∞
            </a>
            <a href="{% url 'month_calendar' today.year today.month %}" class="btn btn-outline-info">
                –°–µ–≥–æ–¥–Ω—è
            </a>
        </div>

        <a href="{% url 'month_calendar' next_year next_month %}" class="btn btn-primary">
            {{ next_month|stringformat:"02d" }}.{{ next_year }} ‚Üí
        </a>
    </div>

</div>

<style>
.week-row {
    min-height: 100px;
}

.day-cell {
    aspect-ratio: 1;
    position: relative;
    padding: 8px;
}

.day-number {
    font-size: 1.1em;
    position: absolute;
    top: 8px;
    right: 8px;
    font-weight: 500;
}

.events {
    position: absolute;
    bottom: 5px;
    left: 5px;
    right: 5px;
    font-size: 0.7rem;
}

/* –î–ª—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–π –∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è */
.bg-warning.bg-opacity-25 {
    background-color: rgba(255, 193, 7, 0.25) !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .week-row {
        min-height: 70px;
    }
    .day-number {
        font-size: 0.9em;
        top: 4px;
        right: 4px;
    }
    .events {
        font-size: 0.6rem;
        bottom: 2px;
        left: 2px;
        right: 2px;
    }
    
    .col.p-2 {
        padding: 4px !important;
        font-size: 0.9em;
    }
}
</style>
{% endblock %}
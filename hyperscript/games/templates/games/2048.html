{% extends 'base.html' %}

{% block title %}2048 - HyperScript{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">üéÆ 2048</h3>
                </div>
                
                <div class="card-body">
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="border rounded p-3 text-center">
                                <small>–°—á–µ—Ç</small>
                                <div class="h3 mb-0 text-primary">{{ score }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="border rounded p-3 text-center">
                                <small>–†–µ–∫–æ—Ä–¥</small>
                                <div class="h3 mb-0 text-warning">{{ high_score }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="border rounded p-3 text-center">
                                <small>–•–æ–¥—ã</small>
                                <div class="h3 mb-0 text-info">{{ moves }}</div>
                            </div>
                        </div>
                    </div>
                    
                    {% if won and not game_over %}
                        <div class="alert alert-success mb-4">
                            <h4>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 2048!</h4>
                            <p class="mb-0">–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏–≥—Ä–∞—Ç—å, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —Å—á–µ—Ç!</p>
                        </div>
                    {% endif %}
                    
                    {% if game_over %}
                        <div class="alert alert-danger mb-4">
                            <h4>üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h4>
                            <p class="mb-0">–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤. –í–∞—à —Å—á–µ—Ç: {{ score }}</p>
                        </div>
                    {% endif %}
                    
                    <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                    <div class="game-board mb-4">
                        <div class="grid-container">
                            {% for i in range %}
                            <div class="grid-row">
                                {% for j in range %}
                                <div class="grid-cell">
                                    <div class="tile tile-{{ grid.i.j|default:0 }} {% if grid.i.j %}tile-show{% endif %}">
                                        {% if grid.i.j %}
                                            {{ grid.i.j }}
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                    <div class="mb-4">
                        {% if not game_over %}
                        <div class="text-center mb-3">
                            <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h5>
                            <div class="btn-group" role="group">
                                <form method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="direction" value="up">
                                    <button type="submit" class="btn btn-outline-primary btn-control">
                                        ‚Üë –í–≤–µ—Ä—Ö
                                    </button>
                                </form>
                            </div>
                            <div class="mt-2">
                                <form method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="direction" value="left">
                                    <button type="submit" class="btn btn-outline-primary btn-control">
                                        ‚Üê –í–ª–µ–≤–æ
                                    </button>
                                </form>
                                
                                <form method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="direction" value="right">
                                    <button type="submit" class="btn btn-outline-primary btn-control">
                                        –í–ø—Ä–∞–≤–æ ‚Üí
                                    </button>
                                </form>
                            </div>
                            <div class="mt-2">
                                <form method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="direction" value="down">
                                    <button type="submit" class="btn btn-outline-primary btn-control">
                                        ‚Üì –í–Ω–∏–∑
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π -->
                        <div class="text-center">
                            <form method="POST" class="d-inline">
                                {% csrf_token %}
                                <input type="hidden" name="new_game" value="1">
                                <button type="submit" class="btn btn-success btn-lg">
                                    üöÄ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                                </button>
                            </form>
                            
                            <a href="{% url 'games_index' %}" class="btn btn-outline-secondary btn-lg ms-2">
                                ‚Üê –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º
                            </a>
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
                    <div class="alert alert-info">
                        <h5>üìã –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:</h5>
                        <ul class="mb-0">
                            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–ª–∏—Ç–æ–∫</li>
                            <li>–ü—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ –¥–≤—É—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–ª–∏—Ç–æ–∫ –æ–Ω–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω—É</li>
                            <li>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –ø–ª–∏—Ç–∫–∞ (2 –∏–ª–∏ 4)</li>
                            <li>–¶–µ–ª—å: —Å–æ–∑–¥–∞—Ç—å –ø–ª–∏—Ç–∫—É —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º <strong>2048</strong></li>
                            <li>–ò–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤</li>
                        </ul>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.game-board {
    background: #bbada0;
    border-radius: 10px;
    padding: 15px;
    margin: 0 auto;
    max-width: 500px;
}

.grid-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.grid-row {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.grid-cell {
    width: 100px;
    height: 100px;
    background: rgba(238, 228, 218, 0.35);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tile {
    width: 100%;
    height: 100%;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    color: #776e65;
    opacity: 0;
    transition: all 0.15s ease;
}

.tile-show {
    opacity: 1;
    transform: scale(1);
}

/* –¶–≤–µ—Ç–∞ –ø–ª–∏—Ç–æ–∫ */
.tile-2 { background: #eee4da; }
.tile-4 { background: #ede0c8; }
.tile-8 { background: #f2b179; color: #f9f6f2; }
.tile-16 { background: #f59563; color: #f9f6f2; }
.tile-32 { background: #f67c5f; color: #f9f6f2; }
.tile-64 { background: #f65e3b; color: #f9f6f2; }
.tile-128 { background: #edcf72; color: #f9f6f2; font-size: 1.8rem; }
.tile-256 { background: #edcc61; color: #f9f6f2; font-size: 1.8rem; }
.tile-512 { background: #edc850; color: #f9f6f2; font-size: 1.8rem; }
.tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 1.5rem; }
.tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 1.5rem; }

.btn-control {
    padding: 10px 20px;
    font-size: 1.1rem;
    margin: 5px;
    min-width: 100px;
}

.btn-control:hover {
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .grid-cell {
        width: 70px;
        height: 70px;
    }
    
    .tile {
        font-size: 1.5rem;
    }
    
    .tile-128, .tile-256, .tile-512 {
        font-size: 1.3rem;
    }
    
    .tile-1024, .tile-2048 {
        font-size: 1.1rem;
    }
    
    .btn-control {
        padding: 8px 15px;
        min-width: 80px;
        font-size: 0.9rem;
    }
}
</style>
{% endblock %}
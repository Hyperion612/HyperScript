{% extends 'base.html' %}

{% block title %}2048 - HyperScript{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">üéÆ 2048</h3>
                    <div class="float-end">
                        <span class="badge bg-warning">–¶–µ–ª—å: 2048</span>
                    </div>
                </div>
                
                <div class="card-body" id="gameContainer2048">
                    <!-- –ò–≥—Ä–æ–≤–∞—è —á–∞—Å—Ç—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ AJAX -->
                    {% include 'games/2048_game.html' %}
                </div>
            </div>
            
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫–∏ -->
            <div class="card mt-4">
                <div class="card-body">
                    <div class="mb-4">
                        {% if not game_over %}
                        <div class="text-center mb-3">
                            <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h5>
                            <div class="d-flex flex-column align-items-center">
                                <!-- –í–≤–µ—Ä—Ö -->
                                <div class="mb-2">
                                    <button type="button" class="btn btn-outline-primary btn-control" onclick="makeMove('up')">
                                        ‚Üë –í–≤–µ—Ä—Ö
                                    </button>
                                </div>
                                
                                <!-- –í–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ -->
                                <div class="d-flex mb-2">
                                    <button type="button" class="btn btn-outline-primary btn-control me-2" onclick="makeMove('left')">
                                        ‚Üê –í–ª–µ–≤–æ
                                    </button>
                                    
                                    <button type="button" class="btn btn-outline-primary btn-control" onclick="makeMove('right')">
                                        –í–ø—Ä–∞–≤–æ ‚Üí
                                    </button>
                                </div>
                                
                                <!-- –í–Ω–∏–∑ -->
                                <div>
                                    <button type="button" class="btn btn-outline-primary btn-control" onclick="makeMove('down')">
                                        ‚Üì –í–Ω–∏–∑
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted">
                                    üí° –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ: 
                                    <kbd>‚Üê</kbd> <kbd>‚Üë</kbd> <kbd>‚Üí</kbd> <kbd>‚Üì</kbd>
                                </small>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π -->
                        <div class="text-center">
                            <button type="button" class="btn btn-success btn-lg" onclick="newGame()">
                                üöÄ –ù–æ–≤–∞—è –∏–≥—Ä–∞
                            </button>
                            
                            <a href="{% url 'games_index' %}" class="btn btn-outline-secondary btn-lg ms-2">
                                ‚Üê –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º
                            </a>
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
                    <div class="alert alert-info">
                        <h5>üìã –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:</h5>
                        <ul class="mb-0">
                            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–ª–∏—Ç–æ–∫</li>
                            <li>–ü—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ –¥–≤—É—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–ª–∏—Ç–æ–∫ –æ–Ω–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω—É</li>
                            <li>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –ø–ª–∏—Ç–∫–∞ (2 –∏–ª–∏ 4)</li>
                            <li>–¶–µ–ª—å: —Å–æ–∑–¥–∞—Ç—å –ø–ª–∏—Ç–∫—É —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º <strong>2048</strong></li>
                            <li>–ò–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript –¥–ª—è AJAX -->
<script>
// CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–æ–≤
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö–æ–¥–∞
function makeMove(direction) {
    console.log('–•–æ–¥:', direction);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ
    const button = document.querySelector(`[onclick="makeMove('${direction}')"]`);
    if (button) {
        button.disabled = true;
        const originalText = button.innerHTML;
        button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 500ms –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
        setTimeout(() => {
            button.disabled = false;
            button.innerHTML = originalText;
        }, 500);
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/games/2048/move/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
        },
        body: JSON.stringify({
            direction: direction
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        updateGame2048(data);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (button) {
            button.disabled = false;
            button.innerHTML = getButtonTextForDirection(direction);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (data.message) {
            showNotification(data.message, data.game_state?.game_over ? 'warning' : 'success');
        }
        
        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞
        if (data.game_state?.game_over) {
            showNotification('üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É.', 'danger');
            disableMoveButtons();
        }
        
        // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ 2048
        if (data.game_state?.won) {
            showNotification('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ 2048!', 'success');
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'danger');
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (button) {
            button.disabled = false;
            button.innerHTML = getButtonTextForDirection(direction);
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
function newGame() {
    console.log('–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const button = document.querySelector('[onclick="newGame()"]');
    if (button) {
        const originalText = button.innerHTML;
        button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
        button.disabled = true;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    fetch('/games/2048/new/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('–ù–æ–≤–∞—è –∏–≥—Ä–∞:', data);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        updateGame2048(data);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (button) {
            button.disabled = false;
            button.innerHTML = originalText;
        }
        
        // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Ö–æ–¥–æ–≤
        enableMoveButtons();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(data.message || '–ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!', 'success');
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π –∏–≥—Ä—ã', 'danger');
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (button) {
            button.disabled = false;
            button.innerHTML = 'üöÄ –ù–æ–≤–∞—è –∏–≥—Ä–∞';
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
function updateGame2048(data) {
    const container = document.getElementById('gameContainer2048');
    if (!container) return;
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = data.html;
    
    // –ó–∞–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
    container.innerHTML = tempDiv.innerHTML;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–ª–∏—Ç–∫–∞–º
    init2048Animations();
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show`;
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    const container = document.getElementById('gameContainer2048');
    if (container) {
        container.insertBefore(notification, container.firstChild);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            const bsAlert = new bootstrap.Alert(notification);
            bsAlert.close();
        }, 3000);
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —Ö–æ–¥–æ–≤
function disableMoveButtons() {
    document.querySelectorAll('.btn-control').forEach(btn => {
        btn.disabled = true;
        btn.classList.add('disabled');
    });
}

// –§—É–Ω–∫—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —Ö–æ–¥–æ–≤
function enableMoveButtons() {
    document.querySelectorAll('.btn-control').forEach(btn => {
        btn.disabled = false;
        btn.classList.remove('disabled');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é
function getButtonTextForDirection(direction) {
    const texts = {
        'up': '‚Üë –í–≤–µ—Ä—Ö',
        'down': '‚Üì –í–Ω–∏–∑',
        'left': '‚Üê –í–ª–µ–≤–æ',
        'right': '–í–ø—Ä–∞–≤–æ ‚Üí'
    };
    return texts[direction] || direction;
}

// –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∏—Ç–æ–∫ 2048
function init2048Animations() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–ª–∏—Ç–∫–∞–º
    const tiles = document.querySelectorAll('.tile-show');
    tiles.forEach((tile, index) => {
        // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
        tile.style.animationDelay = (index * 0.05) + 's';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
        tile.classList.add('tile-new');
        
        // –ï—Å–ª–∏ –ø–ª–∏—Ç–∫–∞ –±–æ–ª—å—à–∞—è (128+), –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ä—Ü–∞–Ω–∏–µ
        const value = parseInt(tile.textContent);
        if (value >= 128) {
            tile.style.animation = 'appear 0.2s ease, pulse 2s infinite';
        }
    });
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    document.querySelectorAll('.btn-control').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            if (!this.disabled) {
                this.style.transform = 'translateY(-3px)';
                this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
            }
        });
        
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
}

// –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
document.addEventListener('keydown', function(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤–≤–µ–¥–µ–Ω–æ –ª–∏ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return;
    }
    
    let direction = null;
    
    switch(e.key) {
        case 'ArrowUp':
        case 'w':
        case '—Ü':
            direction = 'up';
            break;
        case 'ArrowDown':
        case 's':
        case '—ã':
            direction = 'down';
            break;
        case 'ArrowLeft':
        case 'a':
        case '—Ñ':
            direction = 'left';
            break;
        case 'ArrowRight':
        case 'd':
        case '–≤':
            direction = 'right';
            break;
    }
    
    if (direction) {
        e.preventDefault();
        makeMove(direction);
    }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üéÆ 2048 AJAX –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    // –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–ª–µ—Ä—Ç–∞ –æ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã
    const gameOverAlert = document.querySelector('.alert-danger');
    const isGameOver = gameOverAlert !== null;
    
    // –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ —à–∞–±–ª–æ–Ω–µ)
    const firstButton = document.querySelector('.btn-control');
    const buttonsDisabled = firstButton ? firstButton.disabled : false;
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª—é–±–æ–π –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤
    const gameOver = isGameOver || buttonsDisabled;
    
    console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', { gameOver, isGameOver, buttonsDisabled });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    init2048Animations();
    
    // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.btn-control').forEach(btn => {
        const direction = getDirectionFromButton(btn);
        if (direction) {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!btn.getAttribute('onclick')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    makeMove(direction);
                });
            }
        }
    });
    
    // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
    if (gameOver) {
        console.log('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏');
        disableMoveButtons();
    }
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ –∫–Ω–æ–ø–∫–µ
function getDirectionFromButton(button) {
    const text = button.textContent || '';
    if (text.includes('–í–≤–µ—Ä—Ö') || text.includes('‚Üë')) return 'up';
    if (text.includes('–í–Ω–∏–∑') || text.includes('‚Üì')) return 'down';
    if (text.includes('–í–ª–µ–≤–æ') || text.includes('‚Üê')) return 'left';
    if (text.includes('–í–ø—Ä–∞–≤–æ') || text.includes('‚Üí')) return 'right';
    return null;
}
</script>

<style>
/* –°—Ç–∏–ª–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (–æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –±—ã–ª–∏) */
.game-board {
    background: #bbada0;
    border-radius: 10px;
    padding: 15px;
    margin: 0 auto;
    max-width: 500px;
}

.grid-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.grid-row {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.grid-cell {
    width: 100px;
    height: 100px;
    background: rgba(238, 228, 218, 0.35);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.tile {
    width: 100%;
    height: 100%;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    color: #776e65;
    opacity: 0;
    transition: all 0.15s ease;
    position: absolute;
    top: 0;
    left: 0;
}

.tile-show {
    opacity: 1;
    transform: scale(1);
    animation: appear 0.2s ease;
}

@keyframes appear {
    0% { opacity: 0; transform: scale(0.5); }
    100% { opacity: 1; transform: scale(1); }
}

/* –¶–≤–µ—Ç–∞ –ø–ª–∏—Ç–æ–∫ (–æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –±—ã–ª–∏) */
.tile-2 { background: #eee4da; font-size: 2.2rem; }
.tile-4 { background: #ede0c8; font-size: 2.2rem; }
.tile-8 { background: #f2b179; color: #f9f6f2; font-size: 2rem; }
.tile-16 { background: #f59563; color: #f9f6f2; font-size: 1.9rem; }
.tile-32 { background: #f67c5f; color: #f9f6f2; font-size: 1.9rem; }
.tile-64 { background: #f65e3b; color: #f9f6f2; font-size: 1.8rem; }
.tile-128 { background: #edcf72; color: #f9f6f2; font-size: 1.7rem; box-shadow: 0 0 10px rgba(237, 207, 114, 0.5); }
.tile-256 { background: #edcc61; color: #f9f6f2; font-size: 1.7rem; box-shadow: 0 0 10px rgba(237, 204, 97, 0.5); }
.tile-512 { background: #edc850; color: #f9f6f2; font-size: 1.7rem; box-shadow: 0 0 10px rgba(237, 200, 80, 0.5); }
.tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 1.5rem; box-shadow: 0 0 15px rgba(237, 197, 63, 0.5); }
.tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 1.5rem; box-shadow: 0 0 20px rgba(237, 194, 46, 0.7); }

/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.btn-control {
    padding: 12px 25px;
    font-size: 1.1rem;
    margin: 5px;
    min-width: 120px;
    transition: all 0.2s ease;
    border-radius: 8px;
}

.btn-control:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.btn-control:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-control:active:not(:disabled) {
    transform: scale(0.95);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ */
@keyframes pulse {
    0% { box-shadow: 0 0 5px rgba(255,255,255,0.3); }
    50% { box-shadow: 0 0 20px rgba(255,255,255,0.7); }
    100% { box-shadow: 0 0 5px rgba(255,255,255,0.3); }
}

.tile-128, .tile-256, .tile-512, .tile-1024, .tile-2048 {
    animation: pulse 2s infinite;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .game-board {
        padding: 10px;
        max-width: 100%;
    }
    
    .grid-cell {
        width: 70px;
        height: 70px;
    }
    
    .tile {
        font-size: 1.5rem;
    }
    
    .tile-2, .tile-4 { font-size: 1.6rem; }
    .tile-8, .tile-16, .tile-32 { font-size: 1.4rem; }
    .tile-64, .tile-128, .tile-256, .tile-512 { font-size: 1.3rem; }
    .tile-1024, .tile-2048, .tile-4096, .tile-8192 { font-size: 1.1rem; }
    
    .btn-control {
        padding: 10px 15px;
        min-width: 90px;
        font-size: 0.9rem;
    }
    
    .btn-lg {
        padding: 10px 20px;
        font-size: 1rem;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
.alert {
    border-radius: 10px;
    margin-bottom: 15px;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∞–≤–∏—à */
kbd {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 0.9em;
    font-family: monospace;
    box-shadow: 0 2px 0 #dee2e6;
}
</style>

{% endblock %}
{% extends 'base.html' %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - HyperScript{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <div class="h1 mb-3">üë§</div>
                    <h4>{{ user.username }}</h4>
                    <p class="text-muted">{{ user.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
                    <div class="mt-3">
                        <small class="text-muted">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ user.date_joined|date:"d.m.Y" }}</small>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: {{ user.last_login|date:"d.m.Y H:i"|default:"–ù–∏–∫–æ–≥–¥–∞" }}</small>
                    </div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'task_list' %}" class="btn btn-outline-primary btn-sm">üìù –ö –∑–∞–¥–∞—á–∞–º</a>
                        <a href="{% url 'music_player' %}" class="btn btn-outline-success btn-sm">üéµ –ö –º—É–∑—ã–∫–µ</a>
                        <a href="{% url 'math_trainer' %}" class="btn btn-outline-warning btn-sm">üßÆ –¢—Ä–µ–Ω–∞–∂–µ—Ä —Å—á–µ—Ç–∞</a>
                        <a href="{% url 'games_index' %}" class="btn btn-outline-info btn-sm">üéÆ –ö –∏–≥—Ä–∞–º</a>
                        <a href="{% url 'grade_calculator' %}" class="btn btn-outline-secondary btn-sm">üìä –ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</a>
                        <a href="{% url 'year_calendar' %}" class="btn btn-outline-dark btn-sm">üìÖ –ö –∫–∞–ª–µ–Ω–¥–∞—Ä—é</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="border rounded p-2 bg-light">
                                <div class="h4 text-primary mb-1">{{ user.task_set.count|default:"0" }}</div>
                                <small class="text-muted">–ó–∞–¥–∞—á–∏</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="border rounded p-2 bg-light">
                                <div class="h4 text-success mb-1">{{ user.musictrack_set.count|default:"0" }}</div>
                                <small class="text-muted">–¢—Ä–µ–∫–∏</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="border rounded p-2 bg-light">
                                <div class="h4 text-warning mb-1">{{ user.math_scores.count|default:"0" }}</div>
                                <small class="text-muted">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="border rounded p-2 bg-light">
                                <div class="h4 text-info mb-1">{{ user.gamesession_set.count|default:"0" }}</div>
                                <small class="text-muted">–ò–≥—Ä—ã</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row mt-4">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á</h6>
                        </div>
                        <div class="card-body">
                            {% with total_tasks=user.task_set.count completed_tasks=user.task_set.filter.completed.count %}
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>–í—Å–µ–≥–æ –∑–∞–¥–∞—á:</span>
                                    <strong>{{ total_tasks }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                                    <strong class="text-success">{{ completed_tasks }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–í –ø—Ä–æ—Ü–µ—Å—Å–µ:</span>
                                    <strong class="text-warning">{{ total_tasks|add:-completed_tasks }}</strong>
                                </div>
                            </div>
                            {% if total_tasks > 0 %}
                            
                            {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0">üßÆ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏</h6>
                        </div>
                        <div class="card-body">
                            {% with math_scores=user.math_scores.all %}
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:</span>
                                    <strong>{{ math_scores.count }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</span>
                                    <strong>
                                        {% if math_scores %}
                                            {% with total=0 %}
                                                {% for score in math_scores %}
                                                    {{ total|add:score.total_questions }}
                                                {% endfor %}
                                            {% endwith %}
                                        {% else %}
                                            0
                                        {% endif %}
                                    </strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–õ—É—á—à–∏–π —Å—á–µ—Ç:</span>
                                    <strong class="text-success">
                                        {% if math_scores %}
                                            {{ math_scores.0.score }}
                                        {% else %}
                                            0
                                        {% endif %}
                                    </strong>
                                </div>
                            </div>
                            {% endwith %}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0">üéÆ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä</h6>
                        </div>
                        <div class="card-body">
                            {% with game_sessions=user.gamesession_set.all %}
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>–ò–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π:</span>
                                    <strong>{{ game_sessions.count }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–ü–æ–±–µ–¥:</span>
                                    <strong class="text-success">
                                        {% if game_sessions %}
                                            {{ game_sessions.filter.result="win".count }}
                                        {% else %}
                                            0
                                        {% endif %}
                                    </strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–í—Å–µ–≥–æ –æ—á–∫–æ–≤:</span>
                                    <strong class="text-info">
                                        {% if game_sessions %}
                                            {{ game_sessions.0.score }}
                                        {% else %}
                                            0
                                        {% endif %}
                                    </strong>
                                </div>
                            </div>
                            {% endwith %}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º—É–∑—ã–∫–∏ -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">üéµ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º—É–∑—ã–∫–∏</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤:</span>
                                    <strong>{{ user.musictrack_set.count|default:"0" }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–ü–ª–µ–π–ª–∏—Å—Ç–æ–≤:</span>
                                    <strong>0</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>–û–±—â–µ–µ –≤—Ä–µ–º—è:</span>
                                    <strong>--:--</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
            <div class="card shadow-sm mt-2">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º</h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-primary me-2">‚úÖ</span>
                                <span>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</span>
                            </div>
                            <small class="text-muted">–ê–∫—Ç–∏–≤–Ω–æ</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-success me-2">üéµ</span>
                                <span>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä</span>
                            </div>
                            <small class="text-muted">–ê–∫—Ç–∏–≤–Ω–æ</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-warning me-2">üßÆ</span>
                                <span>–¢—Ä–µ–Ω–∞–∂–µ—Ä —Å—á–µ—Ç–∞</span>
                            </div>
                            <small class="text-muted">–ù–æ–≤–æ–µ!</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-info me-2">üéÆ</span>
                                <span>–ò–≥—Ä—ã</span>
                            </div>
                            <small class="text-muted">–ù–æ–≤–æ–µ!</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
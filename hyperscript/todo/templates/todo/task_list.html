{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
    <a href="{% url 'add_task' %}" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</a>
</div>

{% for task in tasks %}
<div class="card mb-3 priority-{{ task.priority }} {% if task.completed %}completed{% endif %}">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
                <h5 class="card-title">{{ task.title }}</h5>
                {% if task.description %}
                    <p class="card-text text-muted">{{ task.description }}</p>
                {% endif %}
                <div class="task-meta">
                    <small class="text-muted">
                        <strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> {{ task.get_priority_display }}
                        {% if task.due_date %}
                            | <strong>–°—Ä–æ–∫:</strong> {{ task.due_date|date:"d.m.Y H:i" }}
                        {% endif %}
                        | <strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ task.created_at|date:"d.m.Y H:i" }}
                    </small>
                </div>
            </div>
            <div class="btn-group ms-3">
                <form method="post" action="{% url 'complete_task' task.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm {% if task.completed %}btn-warning{% else %}btn-success{% endif %}">
                        {% if task.completed %}‚Ü∂ –í–µ—Ä–Ω—É—Ç—å{% else %}‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ{% endif %}
                    </button>
                </form>
                <form method="post" action="{% url 'delete_task' task.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger" 
                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É \"{{ task.title }}\"?')">
                        üóë –£–¥–∞–ª–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="alert alert-info text-center">
    <h5>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á</h5>
    <p>–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–∏!</p>
    <a href="{% url 'add_task' %}" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</a>
</div>
{% endfor %}
{% endblock %}